#!/usr/bin/env python3
import os
import sys

SCRIPT_DIR = os.path.dirname(os.path.realpath(sys.argv[0]))
REPO_ROOT = os.path.dirname(SCRIPT_DIR)
sys.path.insert(0, REPO_ROOT)

from common import load_threads_lines  # type: ignore

def main():
    lines = load_threads_lines()
    section = None
    count = 0
    for line in lines:
        stripped = line.strip()
        if stripped == "Open:":
            section = "open"
            count = 0
            print("Open:")
        elif stripped == "Closed:":
            section = "closed"
            count = 0
            print("Closed:")
        elif stripped.startswith("- [ ]") or stripped.startswith("- [x]"):
            count += 1
            # Remove checkbox and timestamp for display
            content = stripped[5:].strip()
            if "<!--" in content:
                content = content[:content.index("<!--")].strip()
            print(f"{count}. {content}")
        else:
            # Print (none) or blank lines as-is
            print(line, end="")

    print("\nType tt-done N to mark thread N as done.")

if __name__ == "__main__":
    main()
